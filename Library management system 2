#include <stdio.h>
#include <string.h>
#include <conio.h>

struct User {
    char username[50];
    char password[50];
};

struct Book {
    int id;
    char title[50];
    char author[50];
};

// Function to hide password with *
void inputPassword(char *pass) {
    int i = 0;
    char ch;

    while (1) {
        ch = getch();

        if (ch == 13) {  // Enter key
            pass[i] = '\0';
            printf("\n");
            break;
        }
        else if (ch == 8 && i > 0) {  // Backspace
            i--;
            printf("\b \b");
        }
        else {
            pass[i++] = ch;
            printf("*");
        }
    }
}

int signup(struct User *user) {
    printf("\n===== Sign Up =====\n");
    printf("Enter Username: ");
    scanf("%s", user->username);

    printf("Enter Password: ");
    inputPassword(user->password);

    printf("Account Created Successfully!\n");
    return 1;
}

int login(struct User user) {
    char username[50], password[50];
    printf("\n===== Login =====\n");
    printf("Enter Username: ");
    scanf("%s", username);

    printf("Enter Password: ");
    inputPassword(password);

    if (strcmp(username, user.username) == 0 && strcmp(password, user.password) == 0) {
        printf("Login Successful! Welcome, %s.\n", username);
        return 1;
    } else {
        printf("Invalid Username or Password!\n");
        return 0;
    }
}

int main() {
    struct User user;
    struct Book library[100];
    int choice, count = 0, isLoggedIn = 0, hasAccount = 0;

    while (1) {
        if (!isLoggedIn) {
            printf("\n===== Welcome to Library System =====\n");
            printf("1. Sign Up\n");
            printf("2. Login\n");
            printf("3. Exit\n");
            printf("Enter your choice: ");
            scanf("%d", &choice);

            if (choice == 1) {
                hasAccount = signup(&user);
            } 
            else if (choice == 2) {
                if (!hasAccount) {
                    printf("Please Sign Up first!\n");
                } else {
                    isLoggedIn = login(user);
                }
            } 
            else if (choice == 3) {
                printf("Exiting... Goodbye!\n");
                break;
            } 
            else {
                printf("Invalid choice! Try again.\n");
            }
        } 
        else {
            printf("\n===== Library Management Menu =====\n");
            printf("1. Add Book\n");
            printf("2. Display All Books\n");
            printf("3. Search Book by ID\n");
            printf("4. Logout\n");
            printf("Enter your choice: ");
            scanf("%d", &choice);

            if (choice == 1) {
                printf("\nEnter Book ID: ");
                scanf("%d", &library[count].id);
                getchar();

                printf("Enter Book Title: ");
                fgets(library[count].title, 50, stdin);
                library[count].title[strcspn(library[count].title, "\n")] = '\0';

                printf("Enter Author Name: ");
                fgets(library[count].author, 50, stdin);
                library[count].author[strcspn(library[count].author, "\n")] = '\0';

                count++;
                printf("Book Added Successfully!\n");
            } 
            else if (choice == 2) {
                printf("\n--- Book List ---\n");
                for (int i = 0; i < count; i++) {
                    printf("ID: %d\n", library[i].id);
                    printf("Title: %s\n", library[i].title);
                    printf("Author: %s\n\n", library[i].author);
                }
            } 
            else if (choice == 3) {
                int searchId, found = 0;
                printf("\nEnter Book ID to Search: ");
                scanf("%d", &searchId);

                for (int i = 0; i < count; i++) {
                    if (library[i].id == searchId) {
                        printf("\nBook Found!\n");
                        printf("ID: %d\n", library[i].id);
                        printf("Title: %s\n", library[i].title);
                        printf("Author: %s\n", library[i].author);
                        found = 1;
                        break;
                    }
                }
                if (!found) {
                    printf("Book Not Found!\n");
                }
            } 
            else if (choice == 4) {
                printf("Logged out successfully.\n");
                isLoggedIn = 0;
            } 
            else {
                printf("Invalid choice! Try again.\n");
            }
        }
    }

     return 0;
}
